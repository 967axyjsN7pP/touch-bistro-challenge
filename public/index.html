<!doctype html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <title>TouchBistro Challenge App</title>
        <style type="text/css">
            body,
            html {
                color: #888;
                font-family: Arial, sans-serif;
                height: 100%;
                margin: 0;
                padding: 0;
            }

            h1 {
                margin: 24px 0;
            }

            main {
                align-items: center;
                display: flex;
                height: 100%;
                justify-content: center;
                margin: 0 auto;
                max-width: 500px;
            }

            button[type="submit"] {
                background: #ccedef;
                border: none;
                color: #2a8e94;
                cursor: pointer;
                font-size: 1.2em;
                padding: 0 20px;
                transition: all 0.2s;
            }

            button[type="submit"]:focus,
            button[type="submit"]:hover {
                background: #00a3ad;
                color: white;
                transition: all 0.2s;
            }

            button[type="submit"]:active {
                background: #93c8cc;
            }

            button[type="submit"]:disabled {
                background: #d8d8cb;
                color: #a2a294;
            }

            input[type="number"] {
                border: none;
                color: #888;
                flex: 1 1 100%;
                font-size: 1.2em;
                padding: 10px;
            }

            label {
                display: block;
                font-size: 1em;
                font-weight: bold;
                margin-bottom: 8px;
            }

            .container {
                width: 100%;
            }

            .error {
                color: #dc5656;
            }

            .input-wrapper {
                border: 2px solid #ccc;
                border-radius: 5px;
                display: flex;
                flex-direction: row;
                overflow: hidden;
                width: 100%;
            }

            .result {
                color: #777;
                font-size: 1.3em;
                line-height: 1.4em;
            }
        </style>
    </head>
    <body>
        <main>
            <section class="container" id="App"></section>
        </main>
        <script src="https://unpkg.com/react@16/umd/react.development.js" crossorigin></script>
        <script src="https://unpkg.com/react-dom@16/umd/react-dom.development.js" crossorigin></script>
        <script>
            'use strict';

            const e = React.createElement;

            class App extends React.Component {
                constructor(props) {
                    super(props);
                    this.state = {
                        errorMessage: '',
                        isFetching: false,
                        limit: '',
                        medianPrimes: []
                    };
                }

                handleLimitChange(event) {
                    this.setState({ limit: event.target.value });
                }

                handleSubmit(event) {
                    event.preventDefault();

                    this.setState({
                        errorMessage: '',
                        isFetching: true,
                        limit: this.state.limit,
                        medianPrimes: []
                    });

                    fetch(`/api?limit=${this.state.limit}`, {
                        headers: {
                            'Content-Type': 'application/json'
                        },
                        method: 'get'
                    })
                    .then(response => {
                        if (!response.ok) {
                            return response.json()
                                .then(error => Promise.reject(error));
                        }
                        return response.json();
                    })
                    .then(medianPrimes => {
                        this.setState({
                            isFetching: false,
                            medianPrimes
                        });
                    })
                    .catch(error => {
                        this.setState({
                            isFetching: false,
                            errorMessage: error.message
                        });
                    });
                }

                renderResult() {
                    if (this.state.errorMessage) {
                        return e('p', { className: 'error' }, this.state.errorMessage);
                    }

                    let message = null;

                    if (this.state.isFetching) {
                        message = 'Fetching...';
                    }
                    else if (this.state.medianPrimes.length > 1) {
                        message = `The median primes of ${this.state.limit} are ${this.state.medianPrimes.join(' and ')}.`;
                    }
                    else if (this.state.medianPrimes.length === 1) {
                        message = `The median prime of ${this.state.limit} is ${this.state.medianPrimes[0]}.`;
                    }

                    return message ? e('p', { className: 'result' }, message) : null;
                }

                render() {
                    return e(
                        'div',
                        {},
                        e('h1', {}, 'TouchBistro Challenge AppFoo Bar Baz'),
                        e(
                            'form',
                            {
                                onSubmit: event => this.handleSubmit(event)
                            },
                            e('label', { htmlFor: 'Limit' }, 'Enter a limit to get its median prime(s):'),
                            e(
                                'div',
                                { className: 'input-wrapper'},
                                e(
                                    'input',
                                    {
                                        id: 'Limit',
                                        onChange: event => this.handleLimitChange(event),
                                        placeholder: 'Limit',
                                        type: 'number',
                                        value: this.state.limit
                                    }
                                ),
                                e('button', { type: 'Submit' }, 'GET')
                            )
                        ),
                        this.renderResult()
                    );
                }
            }

            ReactDOM.render(e(App), document.getElementById('App'));
        </script>
    </body>
</html>
